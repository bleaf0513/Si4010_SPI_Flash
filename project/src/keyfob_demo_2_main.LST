C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEYFOB_DEMO_2_MAIN
OBJECT MODULE PLACED IN keyfob_demo_2_main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.exe keyfob_demo_2_main.c DB OE BR BROWSE NOAREGS NOINTPROMOTE DEBUG OBJECTEXTEN
                    -D CODE SYMBOLS INCDIR(..\src;..\..\common\src;c:\SiLabs\MCU\Inc)

line level    source

   1          /*------------------------------------------------------------------------------
   2           *                          Silicon Laboratories, Inc.
   3           *                           http://www.silabs.com
   4           *                               Copyright 2010
   5           *------------------------------------------------------------------------------
   6           *
   7           *    FILE:       keyfob_demo_2_main.c
   8           *    TARGET:     Si4010 RevC
   9           *    TOOLCHAIN:  Keil
  10           *    DATE:       Nov 10, 2012,
  11           *    RELEASE:    1.0 (Tamas Nagy), ROM version 02.00
  12           *
  13           *------------------------------------------------------------------------------
  14           *
  15           *    DESCRIPTION:
  16           *      This file contains the main function for the Keil toolchain
  17           *      sample keyfob_demo_2 project.
  18           *
  19           *      BL51 linker directives for building this application:
  20           *
  21           *      BL51: PL(68) PW(78) IXREF RS(256)
  22           *            CODE (0x0-0x08FF)
  23           *            DATA (0x40)
  24           *            IDATA (0x70)
  25           *            XDATA (0x0900-0x107F)
  26           *            STACK (?STACK(0x90))
  27           *
  28           *------------------------------------------------------------------------------
  29           *
  30           *    INCLUDES:
  31           */
  32          
  33          #include <intrins.h>  // must be included at top
  34          #include "stdlib.h"
  35          #include "si4010.h"
  36          #include "si4010_api_rom.h"
  37          #include "keyfob_demo_2.h"
  38          
  39          sbit MY_LED = P0^4;  // LED
  40          
  41          // --- SPI pins ---
  42          sbit PIN_CS  = P1^1; // CS
  43          sbit PIN_CLK = P0^6; // CLK
  44          sbit PIN_D0  = P0^7; // MOSI
  45          sbit PIN_D1  = P1^0; // MISO
  46          
  47          float fReadFreq; 
  48          float fReadDev;
  49          
  50          // --- SPI helpers ---
  51          void Delay_Safe(void) {
  52   1          unsigned char i;
  53   1          for(i=0;i<100;i++) _nop_(); // Keil intrinsic nop
  54   1      }
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 2   

  55          
  56          unsigned char SPI_Swap(unsigned char b)
  57          {
  58   1          unsigned char i, in = 0;
  59   1          for(i=0;i<8;i++)
  60   1          {
  61   2              if(b & 0x80) PIN_D0 = 1; else PIN_D0 = 0;
  62   2              Delay_Safe();
  63   2              PIN_CLK = 1; Delay_Safe();
  64   2              in <<= 1;
  65   2              if(PIN_D1) in |= 1;
  66   2              PIN_CLK = 0; Delay_Safe();
  67   2              b <<= 1;
  68   2          }
  69   1          return in;
  70   1      }
  71          
  72          // --- Load frequency from SPI flash ---
  73          unsigned char Load_Freq(unsigned long addr)
  74          {
  75   1          unsigned char h[2], d[8];
  76   1              unsigned char i;
  77   1          PIN_CS = 0; Delay_Safe(); Delay_Safe();
  78   1      
  79   1          SPI_Swap(0x03); // READ command
  80   1          SPI_Swap((addr>>16)&0xFF);
  81   1          SPI_Swap((addr>>8)&0xFF);
  82   1          SPI_Swap(addr&0xFF);
  83   1          
  84   1          h[0] = SPI_Swap(0xFF);
  85   1          h[1] = SPI_Swap(0xFF);
  86   1          
  87   1          // Check header
  88   1          if(h[0]!=0xA5 || h[1]!=0x5A) { PIN_CS = 1; return 0; }
  89   1      
  90   1          // Read 8 bytes frequency/dev
  91   1          for(i=0;i<8;i++) d[i] = SPI_Swap(0xFF);
  92   1          PIN_CS = 1;
  93   1      
  94   1          // Byte-to-float conversion
  95   1          {
  96   2              unsigned char j;
  97   2              unsigned char *pf = (unsigned char*)&fReadFreq;
  98   2              unsigned char *pd = (unsigned char*)&fReadDev;
  99   2              for(j=0;j<4;j++) { pf[j] = d[j]; pd[j] = d[j+4]; }
 100   2          }
 101   1      
 102   1          return 1;
 103   1      }
 104          
 105          // --- Main function ---
 106          void main(void)
 107          {
 108   1          PDMD = 1;
 109   1          PORT_CTRL &= ~(M_PORT_MATRIX | M_PORT_ROFF | M_PORT_STROBE);
 110   1          vSys_Setup(10); 
 111   1          vSys_BandGapLdo(1); 
 112   1          vSys_LedIntensity(3);
 113   1      
 114   1          lPartID = lSys_GetProdId();
 115   1          bIsr_DebounceCount = 0;
 116   1      
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 3   

 117   1          // --- Button setup ---
 118   1          rBsrSetup.bButtonMask = bButtonMask_c;
 119   1          rBsrSetup.pbPtsReserveHead = abBsrPtsPlaceHolder;
 120   1          rBsrSetup.bPtsSize = 3;
 121   1          rBsrSetup.bPushQualThresh = 3;
 122   1          vBsr_Setup(&rBsrSetup);
 123   1      
 124   1          RTC_CTRL = (0x07 << B_RTC_DIV) | M_RTC_CLR | M_RTC_ENA;
 125   1          ERTC = 1; EA = 1;
 126   1      
 127   1          // --- PA & ODS setup for 315 MHz ---
 128   1          fDesiredFreqOOK = f_315_RkeFreqOOK_c;
 129   1          fDesiredFreqFSK = f_315_RkeFreqFSK_c;
 130   1          bFskDev = b_315_RkeFskDev_c;
 131   1      
 132   1          rPaSetup.bLevel = b_315_PaLevel_c;
 133   1          rPaSetup.wNominalCap = b_315_PaNominalCap_c;
 134   1          rPaSetup.bMaxDrv = b_315_PaMaxDrv_c;
 135   1          rPaSetup.fAlpha = 0.0;
 136   1          rPaSetup.fBeta = 0.0;
 137   1          vPa_Setup(&rPaSetup);
 138   1      
 139   1      #ifdef OOK
                  rOdsSetup.bModulationType = bModOOK_c;
                  vStl_EncodeSetup(bEncodeManchester_c, NULL);
                  fDesiredFreq = fDesiredFreqOOK;
                  bPreamble = bPreambleManch_c;
              #else
 145   1          rOdsSetup.bModulationType = bModFSK_c;
 146   1          vStl_EncodeSetup(bEnc_NoneNrz_c, NULL);
 147   1          fDesiredFreq = fDesiredFreqFSK;
 148   1          bPreamble = bPreambleNrz_c;
 149   1      #endif
 150   1      
 151   1          rOdsSetup.bGroupWidth = 7;
 152   1          rOdsSetup.bClkDiv = 5;
 153   1          rOdsSetup.bEdgeRate = 0;
 154   1          rOdsSetup.bLcWarmInt = 0;
 155   1          rOdsSetup.bDivWarmInt = 5;
 156   1          rOdsSetup.bPaWarmInt = 4;
 157   1          rOdsSetup.wBitRate = 417;
 158   1          vOds_Setup(&rOdsSetup);
 159   1      
 160   1          vFCast_Setup();
 161   1      
 162   1          iBatteryMv = iMVdd_Measure(bBatteryWait_c);
 163   1          bBatStatus = (iBatteryMv >= iLowBatMv_c) ? 1 : 0;
 164   1      
 165   1          vDmdTs_RunForTemp(3);
 166   1          while(bDmdTs_GetSamplesTaken()==0);
 167   1      
 168   1          bStatus = 0; bRepeatCount = 0; bPrevBtn = 0;
 169   1      
 170   1          // --- Main loop ---
 171   1          while(1)
 172   1          {
 173   2              vButtonCheck();
 174   2              if(bButtonState)
 175   2              {
 176   3                  // --- Read frequency from SPI ---
 177   3                  if(!Load_Freq(0x001000))
 178   3                  {
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 4   

 179   4                      MY_LED = 0; // Error blink or signal
 180   4                      continue;
 181   4                  }
 182   3                  fDesiredFreq = fReadFreq;
 183   3                  bFskDev = (unsigned char)fReadDev;
 184   3      
 185   3                  bRepeatCount = bRepeatCount_c;
 186   3                  vRepeatTxLoop();
 187   3              }
 188   2          }
 189   1      }
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 5   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Delay_Safe (BEGIN)
                                           ; SOURCE LINE # 51
                                           ; SOURCE LINE # 53
;---- Variable 'i' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002         ?C0001:
0002 EF                MOV     A,R7
0003 C3                CLR     C
0004 9464              SUBB    A,#064H
0006 7480              MOV     A,#080H
0008 9480              SUBB    A,#080H
000A 5004              JNC     ?C0004
000C 00                NOP     
000D 0F                INC     R7
000E 80F2              SJMP    ?C0001
                                           ; SOURCE LINE # 54
0010         ?C0004:
0010 22                RET     
             ; FUNCTION Delay_Safe (END)

             ; FUNCTION L?0030 (BEGIN)
0000 AF00        R     MOV     R7,addr+03H
0002 AE00        R     MOV     R6,addr+02H
0004 AD00        R     MOV     R5,addr+01H
0006 AC00        R     MOV     R4,addr
0008 120000      E     LCALL   ?C?ULSHR
             ; FUNCTION _SPI_Swap (BEGIN)
                                           ; SOURCE LINE # 56
;---- Variable 'b' assigned to Register 'R6' ----
000B EF                MOV     A,R7
000C FE                MOV     R6,A
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 58
;---- Variable 'in' assigned to Register 'R5' ----
000D E4                CLR     A
000E FD                MOV     R5,A
                                           ; SOURCE LINE # 59
;---- Variable 'i' assigned to Register 'R4' ----
000F FC                MOV     R4,A
0010         ?C0005:
0010 EC                MOV     A,R4
0011 C3                CLR     C
0012 9408              SUBB    A,#08H
0014 7480              MOV     A,#080H
0016 9480              SUBB    A,#080H
0018 5029              JNC     ?C0006
                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 61
001A EE                MOV     A,R6
001B 30E704            JNB     ACC.7,?C0008
001E D287              SETB    PIN_D0
0020 8002              SJMP    ?C0009
0022         ?C0008:
0022 C287              CLR     PIN_D0
0024         ?C0009:
                                           ; SOURCE LINE # 62
0024 120000      R     LCALL   Delay_Safe
                                           ; SOURCE LINE # 63
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 6   

0027 D286              SETB    PIN_CLK
0029 120000      R     LCALL   Delay_Safe
                                           ; SOURCE LINE # 64
002C ED                MOV     A,R5
002D 25E0              ADD     A,ACC
002F FD                MOV     R5,A
                                           ; SOURCE LINE # 65
0030 309004            JNB     PIN_D1,?C0010
0033 CD                XCH     A,R5
0034 4401              ORL     A,#01H
0036 CD                XCH     A,R5
0037         ?C0010:
                                           ; SOURCE LINE # 66
0037 C286              CLR     PIN_CLK
0039 120000      R     LCALL   Delay_Safe
                                           ; SOURCE LINE # 67
003C EE                MOV     A,R6
003D 25E0              ADD     A,ACC
003F FE                MOV     R6,A
                                           ; SOURCE LINE # 68
0040 0C                INC     R4
0041 80CD              SJMP    ?C0005
0043         ?C0006:
                                           ; SOURCE LINE # 69
0043 ED                MOV     A,R5
0044 FF                MOV     R7,A
                                           ; SOURCE LINE # 70
0045 22                RET     
             ; FUNCTION _SPI_Swap (END)

             ; FUNCTION _Load_Freq (BEGIN)
                                           ; SOURCE LINE # 73
0000 8F00        R     MOV     addr+03H,R7
0002 8E00        R     MOV     addr+02H,R6
0004 8D00        R     MOV     addr+01H,R5
0006 8C00        R     MOV     addr,R4
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 77
0008 C291              CLR     PIN_CS
000A 120000      R     LCALL   Delay_Safe
000D 120000      R     LCALL   Delay_Safe
                                           ; SOURCE LINE # 79
0010 7F03              MOV     R7,#03H
0012 120000      R     LCALL   _SPI_Swap
                                           ; SOURCE LINE # 80
0015 7810              MOV     R0,#010H
0017 120000      R     LCALL   L?0030
                                           ; SOURCE LINE # 81
001A 7808              MOV     R0,#08H
001C 120000      R     LCALL   L?0030
                                           ; SOURCE LINE # 82
001F E500        R     MOV     A,addr+03H
0021 FF                MOV     R7,A
0022 120000      R     LCALL   _SPI_Swap
                                           ; SOURCE LINE # 84
0025 7FFF              MOV     R7,#0FFH
0027 120000      R     LCALL   _SPI_Swap
002A 8F00        R     MOV     h,R7
                                           ; SOURCE LINE # 85
002C 7FFF              MOV     R7,#0FFH
002E 120000      R     LCALL   _SPI_Swap
0031 8F00        R     MOV     h+01H,R7
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 7   

                                           ; SOURCE LINE # 88
0033 E500        R     MOV     A,h
0035 64A5              XRL     A,#0A5H
0037 7005              JNZ     ?C0013
0039 EF                MOV     A,R7
003A 645A              XRL     A,#05AH
003C 6005              JZ      ?C0012
003E         ?C0013:
003E D291              SETB    PIN_CS
0040 7F00              MOV     R7,#00H
0042 22                RET     
0043         ?C0012:
                                           ; SOURCE LINE # 91
;---- Variable 'i' assigned to Register 'R3' ----
0043 E4                CLR     A
0044 FB                MOV     R3,A
0045         ?C0015:
0045 EB                MOV     A,R3
0046 C3                CLR     C
0047 9408              SUBB    A,#08H
0049 7480              MOV     A,#080H
004B 9480              SUBB    A,#080H
004D 500E              JNC     ?C0016
004F 7FFF              MOV     R7,#0FFH
0051 120000      R     LCALL   _SPI_Swap
0054 7400        R     MOV     A,#LOW d
0056 2B                ADD     A,R3
0057 F8                MOV     R0,A
0058 EF                MOV     A,R7
0059 F6                MOV     @R0,A
005A 0B                INC     R3
005B 80E8              SJMP    ?C0015
005D         ?C0016:
                                           ; SOURCE LINE # 92
005D D291              SETB    PIN_CS
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 97
005F 750000      R     MOV     pf,#00H
0062 750000      R     MOV     pf+01H,#HIGH fReadFreq
0065 750000      R     MOV     pf+02H,#LOW fReadFreq
                                           ; SOURCE LINE # 98
0068 750000      R     MOV     pd,#00H
006B 750000      R     MOV     pd+01H,#HIGH fReadDev
006E 750000      R     MOV     pd+02H,#LOW fReadDev
                                           ; SOURCE LINE # 99
0071 E4                CLR     A
0072 F500        R     MOV     j,A
0074         ?C0018:
0074 C3                CLR     C
0075 E500        R     MOV     A,j
0077 9404              SUBB    A,#04H
0079 7480              MOV     A,#080H
007B 9480              SUBB    A,#080H
007D 502E              JNC     ?C0019
007F 7400        R     MOV     A,#LOW d
0081 2500        R     ADD     A,j
0083 F8                MOV     R0,A
0084 E6                MOV     A,@R0
0085 AB00        R     MOV     R3,pf
0087 AA00        R     MOV     R2,pf+01H
0089 A900        R     MOV     R1,pf+02H
008B 850082      R     MOV     DPL,j
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 8   

008E 758300            MOV     DPH,#00H
0091 120000      E     LCALL   ?C?CSTOPTR
0094 7400        R     MOV     A,#LOW d+04H
0096 2500        R     ADD     A,j
0098 F8                MOV     R0,A
0099 E6                MOV     A,@R0
009A AB00        R     MOV     R3,pd
009C AA00        R     MOV     R2,pd+01H
009E A900        R     MOV     R1,pd+02H
00A0 850082      R     MOV     DPL,j
00A3 758300            MOV     DPH,#00H
00A6 120000      E     LCALL   ?C?CSTOPTR
00A9 0500        R     INC     j
00AB 80C7              SJMP    ?C0018
00AD         ?C0019:
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 102
00AD 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 103
00AF         ?C0014:
00AF 22                RET     
             ; FUNCTION _Load_Freq (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 106
                                           ; SOURCE LINE # 107
                                           ; SOURCE LINE # 108
0000 D2BA              SETB    PDMD
                                           ; SOURCE LINE # 109
0002 53B51F            ANL     PORT_CTRL,#01FH
                                           ; SOURCE LINE # 110
0005 7F0A              MOV     R7,#0AH
0007 120000      E     LCALL   _vSys_Setup
                                           ; SOURCE LINE # 111
000A 7F01              MOV     R7,#01H
000C 120000      E     LCALL   _vSys_BandGapLdo
                                           ; SOURCE LINE # 112
000F 7F03              MOV     R7,#03H
0011 120000      E     LCALL   _vSys_LedIntensity
                                           ; SOURCE LINE # 114
0014 120000      E     LCALL   lSys_GetProdId
0017 900000      R     MOV     DPTR,#lPartID
001A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 115
001D E4                CLR     A
001E F500        R     MOV     bIsr_DebounceCount,A
                                           ; SOURCE LINE # 118
0020 900000      R     MOV     DPTR,#rBsrSetup
0023 741F              MOV     A,#01FH
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
0026 A3                INC     DPTR
0027 7400        R     MOV     A,#HIGH abBsrPtsPlaceHolder
0029 F0                MOVX    @DPTR,A
002A A3                INC     DPTR
002B 7400        R     MOV     A,#LOW abBsrPtsPlaceHolder
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 120
002E A3                INC     DPTR
002F 7403              MOV     A,#03H
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 121
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 9   

0032 A3                INC     DPTR
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 122
0034 7E00        R     MOV     R6,#HIGH rBsrSetup
0036 7F00        R     MOV     R7,#LOW rBsrSetup
0038 120000      E     LCALL   _vBsr_Setup
                                           ; SOURCE LINE # 124
003B 759C67            MOV     RTC_CTRL,#067H
                                           ; SOURCE LINE # 125
003E D2AB              SETB    ERTC
0040 D2AF              SETB    EA
                                           ; SOURCE LINE # 128
0042 900000      R     MOV     DPTR,#fDesiredFreqOOK
0045 120000      E     LCALL   ?C?LSTKXDATA
0048 4D                DB      04DH
0049 96                DB      096H
004A FE                DB      0FEH
004B C9                DB      0C9H
                                           ; SOURCE LINE # 129
004C 900000      R     MOV     DPTR,#fDesiredFreqFSK
004F 120000      E     LCALL   ?C?LSTKXDATA
0052 4D                DB      04DH
0053 97                DB      097H
0054 04                DB      04H
0055 0C                DB      0CH
                                           ; SOURCE LINE # 130
0056 900000      R     MOV     DPTR,#bFskDev
0059 7466              MOV     A,#066H
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 132
005C 900000      R     MOV     DPTR,#rPaSetup+08H
005F 743C              MOV     A,#03CH
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 133
0062 900000      R     MOV     DPTR,#rPaSetup+0AH
0065 7401              MOV     A,#01H
0067 F0                MOVX    @DPTR,A
0068 A3                INC     DPTR
0069 740E              MOV     A,#0EH
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 134
006C E4                CLR     A
006D 900000      R     MOV     DPTR,#rPaSetup+09H
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
0071 900000      R     MOV     DPTR,#rPaSetup
0074 120000      E     LCALL   ?C?LSTKXDATA
0077 00                DB      00H
0078 00                DB      00H
0079 00                DB      00H
007A 00                DB      00H
                                           ; SOURCE LINE # 136
007B 900000      R     MOV     DPTR,#rPaSetup+04H
007E 120000      E     LCALL   ?C?LSTKXDATA
0081 00                DB      00H
0082 00                DB      00H
0083 00                DB      00H
0084 00                DB      00H
                                           ; SOURCE LINE # 137
0085 7E00        R     MOV     R6,#HIGH rPaSetup
0087 7F00        R     MOV     R7,#LOW rPaSetup
0089 120000      E     LCALL   _vPa_Setup
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 10  

                                           ; SOURCE LINE # 145
008C 900000      R     MOV     DPTR,#rOdsSetup
008F 7401              MOV     A,#01H
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 146
0092 E4                CLR     A
0093 FD                MOV     R5,A
0094 FC                MOV     R4,A
0095 FF                MOV     R7,A
0096 120000      E     LCALL   _vStl_EncodeSetup
                                           ; SOURCE LINE # 147
0099 900000      R     MOV     DPTR,#fDesiredFreqFSK
009C E0                MOVX    A,@DPTR
009D FC                MOV     R4,A
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 FD                MOV     R5,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 FE                MOV     R6,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 FF                MOV     R7,A
00A7 900000      R     MOV     DPTR,#fDesiredFreq
00AA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 148
00AD 7500AA      R     MOV     bPreamble,#0AAH
                                           ; SOURCE LINE # 151
00B0 900000      R     MOV     DPTR,#rOdsSetup+03H
00B3 7407              MOV     A,#07H
00B5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 152
00B6 900000      R     MOV     DPTR,#rOdsSetup+01H
00B9 7405              MOV     A,#05H
00BB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 153
00BC E4                CLR     A
00BD A3                INC     DPTR
00BE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 154
00BF 900000      R     MOV     DPTR,#rOdsSetup+06H
00C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 155
00C3 A3                INC     DPTR
00C4 7405              MOV     A,#05H
00C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 156
00C7 A3                INC     DPTR
00C8 14                DEC     A
00C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 157
00CA 900000      R     MOV     DPTR,#rOdsSetup+04H
00CD 7401              MOV     A,#01H
00CF F0                MOVX    @DPTR,A
00D0 A3                INC     DPTR
00D1 74A1              MOV     A,#0A1H
00D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
00D4 7E00        R     MOV     R6,#HIGH rOdsSetup
00D6 7F00        R     MOV     R7,#LOW rOdsSetup
00D8 120000      E     LCALL   _vOds_Setup
                                           ; SOURCE LINE # 160
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 11  

00DB 120000      E     LCALL   vFCast_Setup
                                           ; SOURCE LINE # 162
00DE 7F64              MOV     R7,#064H
00E0 120000      E     LCALL   _iMVdd_Measure
00E3 8E00        R     MOV     iBatteryMv,R6
00E5 8F00        R     MOV     iBatteryMv+01H,R7
                                           ; SOURCE LINE # 163
00E7 C3                CLR     C
00E8 E500        R     MOV     A,iBatteryMv+01H
00EA 94C4              SUBB    A,#0C4H
00EC E500        R     MOV     A,iBatteryMv
00EE 6480              XRL     A,#080H
00F0 9489              SUBB    A,#089H
00F2 4004              JC      ?C0021
00F4 7F01              MOV     R7,#01H
00F6 8002              SJMP    ?C0022
00F8         ?C0021:
00F8 7F00              MOV     R7,#00H
00FA         ?C0022:
00FA 8F00        R     MOV     bBatStatus,R7
                                           ; SOURCE LINE # 165
00FC 7F03              MOV     R7,#03H
00FE 120000      E     LCALL   _vDmdTs_RunForTemp
0101         ?C0023:
                                           ; SOURCE LINE # 166
0101 120000      E     LCALL   bDmdTs_GetSamplesTaken
0104 EF                MOV     A,R7
0105 60FA              JZ      ?C0023
                                           ; SOURCE LINE # 168
0107 E4                CLR     A
0108 F500        R     MOV     bStatus,A
010A 900000      R     MOV     DPTR,#bRepeatCount
010D F0                MOVX    @DPTR,A
010E F500        R     MOV     bPrevBtn,A
0110         ?C0025:
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
                                           ; SOURCE LINE # 173
0110 120000      E     LCALL   vButtonCheck
                                           ; SOURCE LINE # 174
0113 900000      R     MOV     DPTR,#bButtonState
0116 E0                MOVX    A,@DPTR
0117 60F7              JZ      ?C0025
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 177
0119 7F00              MOV     R7,#00H
011B 7E10              MOV     R6,#010H
011D 7D00              MOV     R5,#00H
011F 7C00              MOV     R4,#00H
0121 120000      R     LCALL   _Load_Freq
0124 EF                MOV     A,R7
0125 7004              JNZ     ?C0028
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
0127 C284              CLR     MY_LED
                                           ; SOURCE LINE # 180
0129 80E5              SJMP    ?C0025
                                           ; SOURCE LINE # 181
012B         ?C0028:
                                           ; SOURCE LINE # 182
012B AF00        R     MOV     R7,fReadFreq+03H
012D AE00        R     MOV     R6,fReadFreq+02H
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 12  

012F AD00        R     MOV     R5,fReadFreq+01H
0131 AC00        R     MOV     R4,fReadFreq
0133 900000      R     MOV     DPTR,#fDesiredFreq
0136 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 183
0139 AF00        R     MOV     R7,fReadDev+03H
013B AE00        R     MOV     R6,fReadDev+02H
013D AD00        R     MOV     R5,fReadDev+01H
013F AC00        R     MOV     R4,fReadDev
0141 120000      E     LCALL   ?C?CASTF
0144 900000      R     MOV     DPTR,#bFskDev
0147 EF                MOV     A,R7
0148 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 185
0149 900000      R     MOV     DPTR,#bRepeatCount
014C 7403              MOV     A,#03H
014E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 186
014F 120000      E     LCALL   vRepeatTxLoop
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 188
0152 80BC              SJMP    ?C0025
             ; FUNCTION main (END)

C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 13  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
RTC_CTRL . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   009CH  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
bBatStatus . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
fReadDev . . . . . . . . . . . . . . .  PUBLIC   DATA   FLOAT    0001H  4
tFCast_XoSetup . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  fXoFreq. . . . . . . . . . . . . . .  MEMBER   -----  FLOAT    0000H  4
  bLowCap. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
tBsr_PtsElement. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  2
  bButtonVector. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bTimestamp . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
EA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AFH  1
LWORD. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
iBatteryMv . . . . . . . . . . . . . .  PUBLIC   DATA   INT      0005H  2
_iMVdd_Measure . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
bPreamble. . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0007H  1
tOds_Setup . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  9
  bModulationType. . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bClkDiv. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  bEdgeRate. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  bGroupWidth. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  wBitRate . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0004H  2
  bLcWarmInt . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
  bDivWarmInt. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  bPaWarmInt . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0008H  1
tBsr_Setup . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  bButtonMask. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  pbPtsReserveHead . . . . . . . . . .  MEMBER   -----  PTR      0001H  2
  bPtsSize . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  bPushQualThresh. . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
lLEDOnTime . . . . . . . . . . . . . .  PUBLIC   XDATA  U_LONG   0000H  4
_vOds_Setup. . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
lPartID. . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_LONG   0004H  4
_vBsr_Setup. . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
bDmdTs_GetSamplesTaken . . . . . . . .  EXTERN   CODE   PROC     -----  -----
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
tPa_Setup. . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  12
  fAlpha . . . . . . . . . . . . . . .  MEMBER   -----  FLOAT    0000H  4
  fBeta. . . . . . . . . . . . . . . .  MEMBER   -----  FLOAT    0004H  4
  bLevel . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0008H  1
  bMaxDrv. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0009H  1
  wNominalCap. . . . . . . . . . . . .  MEMBER   -----  U_INT    000AH  2
_vPa_Setup . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
CHAR . . . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
i8 . . . . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
fDesiredFreqFSK. . . . . . . . . . . .  PUBLIC   XDATA  FLOAT    0008H  4
PIN_CLK. . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0086H  1
PDMD . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BAH  1
main . . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
fDesiredFreqOOK. . . . . . . . . . . .  PUBLIC   XDATA  FLOAT    000CH  4
lTimestamp . . . . . . . . . . . . . .  PUBLIC   DATA   U_LONG   0008H  4
bPrevBtn . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
bFskDev. . . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0010H  1
bIsr_DebounceCount . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000CH  1
_vSys_Setup. . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 14  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


u8 . . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
rOdsSetup. . . . . . . . . . . . . . .  PUBLIC   XDATA  STRUCT   0011H  9
_vDmdTs_RunForTemp . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
ERTC . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ABH  1
rBsrSetup. . . . . . . . . . . . . . .  PUBLIC   XDATA  STRUCT   001AH  5
abFrame. . . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    001FH  24
BYTE . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
pbFrameHead. . . . . . . . . . . . . .  PUBLIC   DATA   PTR      000DH  2
rPaSetup . . . . . . . . . . . . . . .  PUBLIC   XDATA  STRUCT   0037H  12
PIN_D0 . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0087H  1
fDesiredFreq . . . . . . . . . . . . .  PUBLIC   XDATA  FLOAT    0043H  4
PIN_D1 . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
WORD . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
vFCast_Setup . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
vRepeatTxLoop. . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
abConvTable. . . . . . . . . . . . . .  PUBLIC   CODE   ARRAY    0000H  16
_vSys_BandGapLdo . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
i32. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  LONG     -----  4
rXoSetup . . . . . . . . . . . . . . .  PUBLIC   XDATA  STRUCT   0047H  5
i16. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  INT      -----  2
Delay_Safe . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
bRepeatCount . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   004CH  1
vButtonCheck . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
u32. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
MY_LED . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0084H  1
u16. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
TMR2CTRL . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
PORT_CTRL. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B5H  1
PIN_CS . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
wPacketCount . . . . . . . . . . . . .  PUBLIC   DATA   U_INT    000FH  2
bButtonState . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   004DH  1
_SPI_Swap. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     000BH  -----
  b. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0004H  1
  in . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
bStatus. . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0011H  1
wchar_t. . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
bFrameSize . . . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   004EH  1
abBsrPtsPlaceHolder. . . . . . . . . .  PUBLIC   XDATA  ARRAY    004FH  6
_Load_Freq . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  addr . . . . . . . . . . . . . . . .  AUTO     DATA   U_LONG   0000H  4
  j. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000EH  1
  pf . . . . . . . . . . . . . . . . .  AUTO     DATA   PTR      000FH  3
  pd . . . . . . . . . . . . . . . . .  AUTO     DATA   PTR      0012H  3
  h. . . . . . . . . . . . . . . . . .  AUTO     DATA   ARRAY    0004H  2
  d. . . . . . . . . . . . . . . . . .  AUTO     DATA   ARRAY    0006H  8
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0003H  1
_vStl_EncodeSetup. . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
fReadFreq. . . . . . . . . . . . . . .  PUBLIC   DATA   FLOAT    0012H  4
lSys_GetProdId . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
_vSys_LedIntensity . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    603    ----
   CONSTANT SIZE    =     16    ----
C51 COMPILER V9.59.0.0   KEYFOB_DEMO_2_MAIN                                                01/24/2026 04:15:04 PAGE 15  

   XDATA SIZE       =     85    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
